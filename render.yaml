# render.yaml - Configuration pour Render.com
services:
  # Service principal FastAPI
  - type: web
    name: pharmagest-license
    env: python
    region: frankfurt  # Frankfurt gratuit, proche de l'Europe
    plan: free
    healthCheckPath: /health
    autoDeploy: true
    buildCommand: pip install -r requirements.txt
    startCommand: uvicorn license_server:app --host 0.0.0.0 --port 8000 --workers 2
    envVars:
      - key: PYTHON_VERSION
        value: 3.11.0
      - key: RENDER_SERVICE_URL
        value: https://pharmagest-license.onrender.com
    disk:
      name: licenses-data
      mountPath: /opt/render/project/src
      sizeGB: 1

  # Service de ping automatique (gardien)
  - type: cron
    name: keep-alive-ping
    env: python
    region: frankfurt
    plan: free
    schedule: "*/10 * * * *"  # Toutes les 10 minutes
    buildCommand: pip install requests
    runCommand: python keep_alive.py